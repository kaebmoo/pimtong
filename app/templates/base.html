<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pimtong Work Manager</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0ea5e9', // Sky 500
                        secondary: '#64748b', // Slate 500
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- FullCalendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

    {% block header %}{% endblock %}
</head>

<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar"
            class="w-64 bg-gray-800 text-white hidden md:block fixed md:relative z-20 h-full transition-transform transform -translate-x-full md:translate-x-0">
            <div class="p-4 font-bold text-xl flex items-center">
                <i class="fas fa-tools mr-2"></i> Pimtong WM
            </div>
            <nav class="mt-4">
                <a href="/"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
                </a>
                <a href="/jobs"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-clipboard-list mr-2"></i> Work Orders
                </a>

                <a href="/projects"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-project-diagram mr-2"></i> Projects
                </a>

                <a href="/calendar"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-calendar-alt mr-2"></i> Calendar
                </a>

                {% if user.role in ['admin', 'staff'] %}
                <a href="/reports"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-chart-line mr-2"></i> Reports
                </a>
                {% endif %}

                {% if user.role == 'admin' or user.role == 'manager' or user.role == 'staff' %}
                <a href="/teams"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-users-cog mr-2"></i> Teams
                </a>
                <a href="/team"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-user-friends mr-2"></i> Users
                </a>
                <a href="/performance"
                    class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">
                    <i class="fas fa-chart-line mr-2"></i> Performance
                </a>
                {% endif %}
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Navbar -->
            <header class="flex justify-between items-center py-4 px-6 bg-white border-b-4 border-primary">
                <div class="flex items-center">
                    <button
                        onclick="document.getElementById('sidebar').classList.toggle('hidden'); document.getElementById('sidebar').classList.toggle('-translate-x-full');"
                        class="text-gray-500 focus:outline-none md:hidden">
                        <i class="fas fa-bars"></i>
                    </button>
                    <!-- Search -->
                    <div class="relative mx-4 lg:mx-0">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center">
                            <i class="fas fa-search text-gray-500"></i>
                        </span>
                        <input class="form-input w-32 sm:w-64 rounded-md pl-10 pr-4 focus:border-primary" type="text"
                            placeholder="Search...">
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 mr-2 text-right">
                        <div class="text-sm font-semibold text-gray-700">{{ user.full_name }}</div>
                        <div class="text-xs text-gray-500 capitalize">{{ user.role }}</div>
                    </div>
                    <div class="relative group">
                        <button
                            class="relative z-10 block h-8 w-8 rounded-full overflow-hidden border-2 border-gray-600 focus:outline-none focus:border-white">
                            <img class="h-full w-full object-cover"
                                src="https://ui-avatars.com/api/?name={{ user.full_name }}&background=0ea5e9&color=fff"
                                alt="Your avatar">
                        </button>
                        <!-- Dropdown -->
                        <div class="absolute right-0 top-full pt-2 w-48 z-20 hidden group-hover:block hover:block">
                            <div class="bg-white rounded-md overflow-hidden shadow-xl">
                                <a href="/profile"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                                <a href="#" onclick="logout()"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <script>
                async function logout() {
                    await fetch('/api/auth/logout', { method: 'POST' });
                    window.location.href = '/login';
                }
            </script>

            <!-- Scrollable Content -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

</body>

</html>